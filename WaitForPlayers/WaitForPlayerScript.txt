This serverscript is located in the ServerScriptService:

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local updateWaitUI = ReplicatedStorage:WaitForChild("UpdateWaitUI")
local tweenPart = workspace:WaitForChild("TweenPart")

local REQUIRED_PLAYERS = 2
local playersTeleported = false

print("[PlayerManager] Starting player monitoring system...")

local function getTeleportCFrame()
	return tweenPart.CFrame + Vector3.new(0, 5, 0)
end

local function teleportPlayer(player)
	local character = player.Character
	if not character then return end

	local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
	if not humanoidRootPart then return end

	local targetCFrame = getTeleportCFrame()

	local tweenInfo = TweenInfo.new(
		1.5,
		Enum.EasingStyle.Quad,
		Enum.EasingDirection.InOut
	)

	local tween = TweenService:Create(humanoidRootPart, tweenInfo, {CFrame = targetCFrame})
	tween:Play()

	print("[PlayerManager] Tweening player", player.Name, "to TweenPart")
end

local function teleportAllPlayers()
	print("[PlayerManager] Teleporting all players to TweenPart...")
	for _, player in pairs(Players:GetPlayers()) do
		teleportPlayer(player)
	end
	playersTeleported = true
end

local function updateUIForAllPlayers(shouldShowWait)
	updateWaitUI:FireAllClients(shouldShowWait)
	print("[PlayerManager] Updated UI for all clients, showWait:", shouldShowWait)
end

local function checkPlayerCount()
	local playerCount = #Players:GetPlayers()
	print("[PlayerManager] Current player count:", playerCount)

	if playerCount >= REQUIRED_PLAYERS then
		if not playersTeleported then
			updateUIForAllPlayers(false)
			task.wait(0.5)
			teleportAllPlayers()
		end
	else
		updateUIForAllPlayers(true)
		playersTeleported = false
	end
end

Players.PlayerAdded:Connect(function(player)
	print("[PlayerManager] Player joined:", player.Name)

	player.CharacterAdded:Connect(function()
		task.wait(0.1)
		checkPlayerCount()
	end)

	checkPlayerCount()
end)

Players.PlayerRemoving:Connect(function(player)
	print("[PlayerManager] Player leaving:", player.Name)
	checkPlayerCount()
end)

checkPlayerCount()

